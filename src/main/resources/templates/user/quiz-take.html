<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Take Quiz</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <h2 th:text="${quiz.title}"></h2>
        <div id="timer"></div>
        <form id="quizForm" th:action="@{/quiz/submit}" method="post">
            <input type="hidden" name="quizId" th:value="${quiz.id}" />
            <div th:each="question, iterStat : ${quiz.questions}" class="question-card">
                <h4>Q<span th:text="${iterStat.count}"></span>: <span th:text="${question.content}"></span></h4>
                <ul class="options-list">
                    <li th:each="option, optStat : ${question.options}">
                        <input type="radio" th:name="'question_' + ${question.id}" th:id="'q' + ${question.id} + 'o' + ${optStat.index}" th:value="${optStat.index}" required>
                        <label th:for="'q' + ${question.id} + 'o' + ${optStat.index}" th:text="${option}"></label>
                    </li>
                </ul>
            </div>
            <button type="submit" class="btn">Submit Quiz</button>
        </form>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const timeLimit = /*[[${quiz.timeLimitInSeconds}]]*/;
        const timerElement = document.getElementById('timer');
        const quizForm = document.getElementById('quizForm');
        let timeLeft = timeLimit;

        const timerInterval = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `Time Left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert('Time is up! Submitting your answers.');
                quizForm.submit();
            }
        }, 1000);
        /*]]>*/
    </script>
</body>
</html>